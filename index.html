<!DOCTYPE html>
<html>
    <head>
        <title>Crimes in U.S. Institutions</title>
        <style type  = "text/css">
            div.tooltip{
                position: absolute;
                text-align: center;
                width: 100px;
                height: 28px;
                padding: 2px;
                font: 12px sans-serif;
                background: rgb(0, 255, 150);
                border: 0px;
                border-radius: 8px;
                pointer-events: none;
            }
        </style>
    </head>
    <body>
        <h1>Crimes Devided by States</h1>
        <script src="https://d3js.org/d3.v3.min.js"></script>
        <script src="https://d3js.org/topojson.v1.min.js"></script>
        <script src="https://d3js.org/queue.v1.min.js"></script>
        <script>
            //SVG
            var svg = d3.select("body").append("svg")
            .attr("width", 1272)
            .attr("height", 680)
            .append("a")
            .attr("transform", "translate(50, 20)");
            
            var projection = d3.geo.albersUsa()
            .translate([636, 340])
            .scale([1000]);
            
            var path = d3.geo.path().projection(projection);
            
            queue()
            .defer(d3.json, "Data/states.json")
            .defer(d3.csv, "Data/crimeDevidedByStates.csv")
            .await(mapping);
            
            function mapping(error, states, crimeDevidedByStates){
                if (error){
                    console.log(error);
                }
                
                var div = d3.select("body").append("div")
                .attr("class", "tooltip")
                .style("opacity", 0);
                
                var dataset = [];
                
                for (var i = 0; i < crimeDevidedByStates.length; i++){
                    dataset[i] = [];
                    dataset[i][0] = +crimeDevidedByStates[i].ID;
                    dataset[i][1] = crimeDevidedByStates[i].State;
                    dataset[i][2] = +crimeDevidedByStates[i].Total;
                }
                
                svg.selectAll("pathUS")
                .data(states.features)
                .enter()
                .append("path")
                .attr("stroke-width", 1)
                .attr("stroke", "#ccc")
                .attr("d", path)
                .attr("id", function(d){
                      return "s" + d.id;
                })
                .on("mouseover", function(d, i){
                    d3.select(this).transition()
                    .duration(200)
                    .attr("fill", "orange");
                    div.transition()
                    .duration(200)
                    .style("opacity", 0.8);
                    for (var i = 0; i < dataset.length; i++){
                        if (d.id == dataset[i][0]){
                            div.html(d.properties.name + "<br/>" + dataset[i][2] + " Crimes")
                            .style("left", (d3.event.pageX) + "px")
                            .style("top", (d3.event.pageY - 28) + "px");
                        }
                    }
                })
                .on("mouseout", function(d, i){
                    d3.select(this).transition()
                    .duration(500)
                    .attr("fill", color(+crimeDevidedByStates[i].Total));
                    div.transition()
                    .duration(500)
                    .style("opacity", 0);
                });
                
                var color = d3.scale.threshold()
                .domain([0, 73, 146, 219, 292, 365, 438, 511, 584, 657])
                .range(["black", "#ffffe5", "#f7fcb9", "#d9f0a3", "#addd8e", "#78c679", "#41ab5d", "#238443", "#006837", "#004529"]);
                
                for (var i = 0; i < crimeDevidedByStates.length; i++){
                    d3.select("#s" + crimeDevidedByStates[i].ID).attr("fill", color(+crimeDevidedByStates[i].Total));
                
                }
            }
        </script>
    </body>
</html>
